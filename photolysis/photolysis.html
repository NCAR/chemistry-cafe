    <!--
    Select purpose of visit.
    -->

    <div class="btn-group">
        <label class="btn btn-primary" ng-model="purpose" btn-radio="'branchSelect'" ng-show="editp==1">Select Reactions<br>For Mechanism</label>
        <label class="btn btn-primary" ng-model="purpose" btn-radio="'masterEdit'">Edit<br>Reactions</label>
        <label class="btn btn-primary" ng-model="purpose" ng-click="createDefault()" btn-radio="'addReaction'" ng-show="editp==1">Add New<br>Reaction</label>
        <label class="btn btn-primary" ng-model="purpose" btn-radio="'markObsolete'" ng-show="editp==1">Mark<br>Obsolete</label>
        <label class="btn btn-primary" ng-model="purpose" btn-radio="'showReferences'">Show/Link<br>References</label>
        <label class="btn btn-primary" ng-model="purpose" btn-radio="'groupSelect'" ng-show="editp==1">Assign<br>Section</label>
    </div> 

    <div ng-show="purpose=='branchSelect'" ng-show="editp==1" >
        <h4>Select Reactions for which branch?</h4>
        <select  style="width:240px;border:1px;overflow:hidden;height:40px'"
            ng-model="selectedBranch" 
            ng-options="branch as branch.name for branch in branchArray" > 
            <option value="">-- Mechanism --</option>
        </select> 
    </div>
    <!--
    Modify reactions
    -->
    <div ng-show="(purpose == 'editPhotolysis' || purpose == 'addReaction') && (editp == 1)">
        <hr>
        <form class="form-horizontal">
          <div class ="form-group">
              <label class="col-sm-2 control-label">Reaction Section:</label>
              <div class="col-sm-4 ">
                  <select class="form-control" name="fsection" ng-model="formData.group_id"
                      ng-options="group.id as group.description for group in photolysisGroups">
                      <option value="">--- Select ---</option> <!-- not selected / blank option -->
                  </select>
              </div>
          </div>
          <div class ="form-group">
            <label class="col-sm-2 control-label">CESM Rate:</label>
            <div class="col-sm-6 ">
                <input type="text" size=20 ng-model="formData.rate" placeholder="Photolysis Rate">
            </div>
          </div>
          <div class ="form-group">
            <label class="col-sm-2 control-label">WRF Rate:</label>
            <div class="col-sm-2 ">
                <input type="text" size=10 ng-model="formData.wrfRateCoeffEdit" placeholder="Photolysis Rate Coeff">_real8 
            </div>
            <div class="col-md-1 "> &#10033 </div>
            <div class="col-md-3">
              <select class="form-control" ng-model="formData.wrfRateId"
                ng-options="wrfRate.id as wrfRate.name for wrfRate in wrfRates">
              </select>
            </div>
          </div>
          <div class ="form-group">
            <label class="col-sm-2 control-label">MICM Rate:</label>
            <div class="col-sm-2 ">
                <input type="text" size=10 ng-model="formData.micmRateCoeffEdit" placeholder="Photolysis Rate Coeff">_real8
            </div>
            <div class="col-md-1 "> &#10033 </div>
            <div class="col-md-3">
              <select class="form-control" ng-model="formData.micmRateId"
                ng-options="micmRate.id as micmRate.description for micmRate in micmRates">
              </select>
            </div>
          </div>

          <div class ="form-group">
            <label class="col-sm-2 control-label">Molecule:</label>
            <div class="col-sm-4 ">
                <input type="text" size=20 ng-model="formData.molecule" placeholder="Decomposing Molecule">
            </div>
          </div>
          <div class ="form-group">
            <label class="col-sm-2 control-label">Products:</label>
            <div class="col-sm-4 ">
                <input type="text" size=20 ng-model="productStringEdit" placeholder="3*CO2 + 8.67*O">
            </div>
          </div>
          <div class ="form-group">
            <label class="col-sm-2 control-label">{{initials}} : {{today | date :'yyyy-MM-dd'}} :</label>
            <div class="col-sm-4 ">
                <textarea rows="5" cols="50" 
                       ng-model="commentEdit" 
                       placeholder="Add A Comment. Your initials and date will be prepended automatically."> 
                  </textarea> 
            </div>
          </div>
          <div class ="form-group">
            <label class="col-sm-2 control-label"></label>
            <input class="btn btn-primary col-sm-2" type="button" name="reset_form" value="Cancel This Edit" ng-click="reset_modify_form()">
            <input class="btn btn-primary col-sm-2" type="button" value ="Validate" ng-click="validate()">
          </div>
        </form>
    </div>
    <!--
    Display For Review
    -->
    <div ng-show="purpose == 'editPhotolysis'">
        <hr>
        <h5>For these branches ( <strong>{{branchStringEdit}}</strong> ) </h5>
        <p>{{previousRate}}</p>
        <p>{{previousMolecule}} &rarr; {{previousProductString}}</p>
        <div  ng-show="editp==1">
            <h4><strong>---- Changing to -----</strong></h4>
            <p>{{formData.rate}}</p>
            <p>{{formData.molecule}} &rarr; {{productStringEdit}}</p> <br />
            <p>{{initials}} : {{today | date :'yyyy-MM-dd'}} : {{commentEdit}}</p>
        </div>
        <p><span ng-bind-html="previousCommentsFormatted | unsafe"></p> <br>
        <input class="btn btn-success col-sm-2" type="button" name="reset_form" value="Cancel This Edit" ng-click="reset_modify_form()">
        <input class="btn btn-success" type="button" value="Commit Modification" ng-click="modify_photolysis()" ng-show="editp==1">
    </div>
    <!--
    Create New Reaction
    -->
    <div ng-show="purpose == 'addReaction'">
    <form name="create_reactions" class="wrapper" ng-show="purpose == 'addReaction'">
        <hr>
        <h5 ><strong>Create :</strong></h5>
        <p>{{formData.rate}}</p>
        <p>{{formData.molecule}} &rarr; {{productStringEdit}}</p>
        <p>{{initials}} : {{today | date :'yyyy-MM-dd'}} : {{commentEdit}}</p> <br>
        <input class="btn btn-success" type="button" value="Create New" ng-click="create_photolysis()">
    </div>
    <!--
    Edit References
    -->
    <div name="edit_references" class="wrapper" ng-show="purpose=='editReferences'">
        <h5 ><strong>Reaction :</strong></h5>
        <p>Mechanisms:  {{branchString}}</p>
        <p>Rate:  {{rate}}</p>
        <p>{{molecule}} &rarr; {{productString}}</p>
        <div  ng-show="editp==1">
        Add References:
            <select ng-model="selectedReference" 
                    ng-change="addReference()"
                    ng-options="reference.desc for reference in allReferences"> </select>
        </div>
        <table class="table table-striped table-bordered" >
        <thead>
            <th >ID</th>
            <th ng-show="editp==1"> Remove<br>Reference</th>
            <th >Reference<br>Label</th>
            <th >File</th>
            <th >DOI</th>
            <th >Details</th>
            <th >Citation</th>
            <th >User</th>
            <th >http</th>
        </thead>
        <tbody>
            <tr ng-repeat="phReference in phReferences">
                <td>{{ phReference.id }}</td>
                <td><a ng-show="editp==1" ng-click="deletePhotolysisReference(phReference.id,pid)">Remove</a></td>
                <td>{{ phReference.label }}</td>
                <td><a ng-click="fileshow(phReference.id,phReference.filename)">{{ phReference.filename }}</a></td>
                <td>{{ phReference.doi }}</td>
                <td>{{ phReference.detail }}</td>
                <td>{{ phReference.citation }}</td>
                <td>{{ phReference.initials }}</td>
                <td>{{ phReference.http }}</td>
            </tr>
         </tbody>
         </table>
         <input type="button" name="reset_form" value="Finished" ng-click="purpose = 'showReferences'"><br />
    </div><br />

    <!--
    Display Reactions if a purpose has been chosen
    -->
    <div> 
        <hr>
            <p> Display only reactions satifying the filters: </p>
            <input type="text" ng-model="molecule_filter" ng-change="filter()" placeholder="Molecule Filter" >
            AND
            <input type="text" ng-model="product_filter" ng-change="filter()" placeholder="Product Filter" >
            AND
            <span class="nullable">
              <select ng-model="group_filter"
                ng-options="g_filter.description for g_filter in photolysisGroups" >
              <option value="">-- All Sections --</option>
              </select>
            </span>
            AND
            <span class="nullable">
              <select ng-model="branch_filter"
                ng-options="b_filter.name for b_filter in branchArray" >
              <option value="">-- All Mechanisms --</option>
              </select>
            </span><br>
            <h6 align="left">Showing {{ filtered.length }}/{{ totalItems}} of the Reactions in the Database</h6>
        <br/>
        
        <div class="row">
        <div class="col-md-12">
            <table class="table table-striped table-bordered" >
            <thead>
<!--
                <th >ID</th>
-->
                <th ng-show="purpose=='masterEdit'"> </th>
                <th ng-show="purpose=='markObsolete'">Obsolescence</th>
                <th ng-show="purpose=='branchSelect' && selectedBranch"> Select into Mechanism </th>
                <th ng-show="purpose=='showReferences'">References</th>
                <th ng-show="purpose=='groupSelect'">Section</th>
                <th>Molecule</a></th>
                <th>Rate</a></th>
                <th>Products</th>
                <th>Mechanisms</th>
            </thead>
            <tbody> 
            <tr ng-repeat="photolysis in filtered 
                            = (pagedItems 
                            | showFilteredGroup:group_filter
                            | showFilteredBranch:branch_filter
                            | filter:{molecule:molecule_filter} 
                            | filter:{productString:product_filter} 
                            | hideIrrelevant:purpose
                            )">
<!--
                            | orderBy : predicate :reverse
                <td>{{ photolysis.id }}</td>
-->
                <td ng-show="purpose=='masterEdit'">
                    <button type = "button" ng-click="populateEditForm(photolysis)"  ng-show="editp==1">Edit</button>
                    <button type = "button" ng-click="cloneToCreate(photolysis)" ng-show="editp==1">Clone</button>
                    <button type = "button" ng-click="populateEditForm(photolysis)"  ng-show="editp==0">Show</button>
                </td>
                <td ng-show="purpose=='markObsolete'">
                    <input type = "checkbox" ng-click="toggleDeprecatedPhotolysis(photolysis)" ng-model="photolysis.obsolete" ng-show="editp==1">
                    Obsolete
                </td>
                <td ng-show="purpose=='branchSelect' && selectedBranch">
                    <input type="checkbox" ng-click="togglephotolysisinbranch(photolysis)" ng-checked="reactiononbranch(photolysis)" >
                    <span class="valueItems"><strong>{{selectedBranch.name}}</strong> </span>
                </td>
                <td ng-show="purpose=='showReferences'">
                    <button type = "button" ng-click="editReferences(photolysis)" >Edit</button>
                </td>
                <td ng-show="purpose=='groupSelect'">
                    <select 
                        ng-model="photolysis.group_id"
                        ng-change="changeGroup(photolysis)"
                        ng-options="photolysisGroup.id as photolysisGroup.description for photolysisGroup in photolysisGroups" >
                </td>
                <td>{{ photolysis.molecule }}</td>
                <td>{{ photolysis.rateDescription }}</td>
                <td>{{ photolysis.productString }}</td>
                <td>{{ photolysis.branchArray.length }}</td>
            </tr> 
            </tbody>
            </table>
        </div> <!-- end of div class col-md-12 -->
        <div class="col-md-12" ng-show="filteredItems == 0"> 
            <h4>Photolysis reactions loading.... </h4> 
        </div> <!-- end of div class row -->
    </div>  <!-- ng-show -->
    <!-- end of display of reactions -->
